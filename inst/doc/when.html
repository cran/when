<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2024-01-08" />

<title>Generating the When Dimension based on date and time tables</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Generating the When Dimension based on date
and time tables</h1>
<h4 class="date">2024-01-08</h4>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>The <em>When Dimension</em> plays a fundamental role in
<em>Multidimensional Systems</em>, it allows us to express
<strong>when</strong> the analysed focus of attention have occurred.</p>
<p>This dimension corresponds to the generically called “Time
Dimension”, as named in <span class="citation">Kimball (1996)</span> and
<span class="citation">Adamson (2010)</span>. Later it has also been
called “Date Dimension” (date-based dimension) and “Time Dimension”
(time-of-day-based dimension) to express granularity <span class="citation">(Kimball and Ross 2013)</span>. We prefer to call it
“When Dimension” because granularity is not involved in that term.</p>
<p>Although conceptually the date and time can be represented together
in a single dimension, in ROLAP (<em>Relational On-Line Analytical
Processing</em>) star database systems, it is common to implement these
concepts separately, sometimes in separate tables “to avoid a row count
explosion in the date dimension” <span class="citation">(Kimball and
Ross 2013)</span> by adding the time for each day.</p>
<p>In <span class="citation">Kimball and Ross (2013)</span> these
dimensions are considered <em>static dimensions</em>: they are built at
the beginning of the project for the period under consideration and are
referenced when adding the instances to the fact table. As mentioned
there: “Typically, these dimensions are built in an afternoon with a
spreadsheet.”</p>
<p>The purpose of the <code>when</code> package is to assist in the
implementation of the <strong><em>When Dimension</em></strong> in
Multidimensional Systems implemented on a ROLAP star database,
regardless of its granularity, with the following features:</p>
<ul>
<li><p>It supports the generation of tables with the granularity needed
(second, minute, hour, date, week, month, quarter, semester or year)
according to the relational star schema design criteria <span class="citation">(Kimball and Ross 2013)</span>.</p></li>
<li><p>We consider separate tables for <strong>time-of-day</strong> data
and data obtained from <strong>date</strong> to avoid a row count
explosion if a single table were used.</p></li>
<li><p>It can be used to generate tables <strong>statically</strong>,
indicating a period, or <strong>dynamically</strong>, indicating data
series.</p></li>
<li><p>In addition to attributes at the selected granularity, other
attributes can be added at coarser granularity to facilitate querying.
We can also add a surrogate key.</p></li>
<li><p>We can obtain the tables in <code>tibble</code> format and in
other formats (<em>xlsx</em>, <em>csv</em> or <em>Relational DBMS</em>
table).</p></li>
</ul>
<p>It relies on the functions offered by the <a href="https://CRAN.R-project.org/package=lubridate"><code>lubridate</code></a>
package to obtain the components from the date and time.</p>
<p>The rest of this document is structured as follows: First, the
general process of defining these dimensions is presented. Next, we
present dimension-specific aspects that we can define, both for
date-based and time-based dimensions. Finally, the document ends with
conclusions and bibliography.</p>
</div>
<div id="definition-process" class="section level1">
<h1>Definition process</h1>
<p>The definition process consists of the following steps:</p>
<ol style="list-style-type: decimal">
<li>Creating an object.</li>
<li>Definition of general aspects.</li>
<li>Definition of instances.</li>
<li>Selection of levels and attributes.</li>
<li>Generation of the result.</li>
<li>Getting the dimension table.</li>
</ol>
<p>Steps 2, 3 and 4 can be done in any order, they can even be included
in step 1.</p>
<p>Below we discuss each of them.</p>
<div id="creating-an-object" class="section level2">
<h2>Creating an object</h2>
<p>The definition process begins by creating an object of the
<code>when</code> class.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(when)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>w_date <span class="ot">&lt;-</span> <span class="fu">when</span>()</span></code></pre></div>
<p>By default, an object is created based on date, but we can also
create it based on time by indicating it using the <code>type</code>
parameter.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>w_time <span class="ot">&lt;-</span> <span class="fu">when</span>(<span class="at">type =</span> <span class="st">&#39;time&#39;</span>)</span></code></pre></div>
<p>Virtually all configuration options can be defined using the object
creation function. They can also be defined later using specific
functions, as shown in the following section.</p>
</div>
<div id="general_aspects" class="section level2">
<h2>Definition of general aspects</h2>
<p>For example, using the following combination of functions we get the
same result as defining the type when we create the object.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>w_time_2 <span class="ot">&lt;-</span> <span class="fu">when</span>() <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="fu">define_characteristics</span>(<span class="at">type =</span> <span class="st">&#39;time&#39;</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="fu">identical</span>(w_time, w_time_2)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>By default it considers the system language. Since our system is
Spanish, for the literals of day and month names to appear in English,
we must configure it explicitly.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>w_date <span class="ot">&lt;-</span> w_date <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="fu">define_characteristics</span>(<span class="at">locale =</span> <span class="fu">Sys.setlocale</span>(<span class="st">&quot;LC_TIME&quot;</span>, <span class="st">&quot;English&quot;</span>))</span></code></pre></div>
<p>In section <a href="#other_config_options">Other configuration
options</a> we present the rest of the configuration options for
dimension generation. For the examples that we are going to use, the
default options of the package are enough.</p>
<p>Next we have to select and configure the levels and define the
instances. These operations, along with the current one, can be
performed in any order.</p>
</div>
<div id="definition-of-instances" class="section level2">
<h2>Definition of instances</h2>
<p>We can define the instances by giving a range of values or by
indicating the specific instances. The values in both cases will depend
on the type of dimension (date-based or time-based).</p>
<p>We can indicate these values at the time of creating the class object
or through the <code>define_instances()</code> function.</p>
<ul>
<li><p>In the case of date, we can indicate a year, year and month (with
the format <code>yyyy-mm</code>), or year month and day
(<code>yyyy-mm-dd</code>).</p></li>
<li><p>In the case of time, we can indicate an hour, hour and minute
(with the format <code>hh:mm</code>), or hour, minute and second
(<code>hh:mm:ss</code>).</p></li>
</ul>
<p>In both cases we can use the string format, the one provided by the
<a href="https://CRAN.R-project.org/package=lubridate"><code>lubridate</code></a>
package or, when it is a single number (year or hour), we can use an
integer value.</p>
<p>For example, below they are used with the format of
<code>lubridate</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>w_date <span class="ot">&lt;-</span> w_date <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="fu">define_instances</span>(<span class="at">start =</span> lubridate<span class="sc">::</span><span class="fu">today</span>(),</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>                   <span class="at">end =</span> lubridate<span class="sc">::</span><span class="fu">today</span>() <span class="sc">+</span> lubridate<span class="sc">::</span><span class="fu">years</span>(<span class="dv">5</span>))</span></code></pre></div>
<p>In the following definitions we configure the dimensions so that they
consider only the indicated dates. The second will be appropriate if we
want to obtain the dimension at the year level, because we are
indicating the specific values to consider (not a period).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>w_date_2_1 <span class="ot">&lt;-</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="fu">when</span>(</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>      <span class="st">&quot;2023-12-31&quot;</span>,</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>      <span class="st">&quot;2023-01-01&quot;</span>,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>      <span class="st">&quot;2022-12-31&quot;</span>,</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>      <span class="st">&quot;2022-01-01&quot;</span>,</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>      <span class="st">&quot;2021-12-31&quot;</span>,</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>      <span class="st">&quot;2021-01-01&quot;</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>    )</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>  )</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>w_date_2_2 <span class="ot">&lt;-</span> w_date <span class="sc">|&gt;</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>  <span class="fu">define_instances</span>(<span class="at">values =</span> <span class="dv">2020</span><span class="sc">:</span><span class="dv">2030</span>)</span></code></pre></div>
<p>The following definition will be appropriate at any level of detail
because we are giving the range of values to consider (dates between
those two years).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>w_date_3 <span class="ot">&lt;-</span> w_date <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="fu">define_instances</span>(<span class="at">start =</span> <span class="dv">2020</span>, <span class="at">end =</span> <span class="dv">2030</span>)</span></code></pre></div>
<p>When only the year is indicated, it is considered its first day.
Therefore the previous definition is equivalent to the following
one.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>w_date_4 <span class="ot">&lt;-</span> w_date <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="fu">define_instances</span>(<span class="at">start =</span> <span class="st">&quot;2020-01-01&quot;</span>, <span class="at">end =</span> <span class="st">&quot;2030-01-01&quot;</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="fu">identical</span>(w_date_3, w_date_4)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>In the case of time, by default, it is considered at second level and
all seconds of the day.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>w_time_3 <span class="ot">&lt;-</span> w_time <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="fu">define_instances</span>(<span class="at">start =</span> <span class="st">&quot;00:00:00&quot;</span>, <span class="at">end =</span> <span class="st">&quot;23:59:59&quot;</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="fu">identical</span>(w_time, w_time_3)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>We can also indicate a period or a set of times according to the
indicated criteria. In the following example, the two definitions are
equivalent.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>w_time_4 <span class="ot">&lt;-</span> w_time <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="fu">define_instances</span>(<span class="at">start =</span> <span class="dv">8</span>, <span class="at">end =</span> <span class="dv">17</span>)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>w_time_5 <span class="ot">&lt;-</span> w_time <span class="sc">|&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="fu">define_instances</span>(<span class="at">start =</span> <span class="st">&quot;08:00:00&quot;</span>, <span class="at">end =</span> <span class="st">&quot;17:00:00&quot;</span>)</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="fu">identical</span>(w_time_4, w_time_5)</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div id="selection-of-levels-and-attributes" class="section level2">
<h2>Selection of levels and attributes</h2>
<p>In the definition, by default, the attributes that we have considered
to be most frequently used have been included. We can consult them for
each level using the <code>get_level_attribute_names()</code> function
with the parameter <code>selected = TRUE</code>. If we define the
parameter as <code>selected = FALSE</code> (default option), it will
return all available attributes. We can indicate the name of the level
or, if we do not indicate any, it will obtain the attributes of all the
levels. We obtain the level names using the
<code>get_level_names()</code> function. Below are examples of using
these functions for the date-based dimension.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>w_date <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="fu">get_level_attribute_names</span>(<span class="at">selected =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;date&quot;           &quot;month_day&quot;      &quot;week_day&quot;       &quot;day_name&quot;      </span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;day_num_name&quot;   &quot;year_week&quot;      &quot;week&quot;           &quot;year_month&quot;    </span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;month&quot;          &quot;month_name&quot;     &quot;month_num_name&quot; &quot;year&quot;</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>w_date <span class="sc">|&gt;</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>  <span class="fu">get_level_names</span>()</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">#&gt; [1] &quot;day&quot;      &quot;week&quot;     &quot;month&quot;    &quot;quarter&quot;  &quot;semester&quot; &quot;year&quot;</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>w_date <span class="sc">|&gt;</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>  <span class="fu">get_level_attribute_names</span>(<span class="at">name =</span> <span class="st">&#39;month&#39;</span>, <span class="at">selected =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#&gt; [1] &quot;year_month&quot;     &quot;month&quot;          &quot;month_name&quot;     &quot;month_num_name&quot;</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>w_date <span class="sc">|&gt;</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>  <span class="fu">get_level_attribute_names</span>(<span class="at">name =</span> <span class="st">&#39;month&#39;</span>)</span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="co">#&gt; [1] &quot;year_month&quot;     &quot;month&quot;          &quot;month_name&quot;     &quot;month_num_name&quot;</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#&gt; [5] &quot;month_abbr&quot;     &quot;month_num_abbr&quot;</span></span></code></pre></div>
<p>Also for the time-based dimension.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>w_time <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="fu">get_level_attribute_names</span>()</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;time&quot;     &quot;hour&quot;     &quot;minute&quot;   &quot;second&quot;   &quot;day_part&quot;</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>w_time <span class="sc">|&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>  <span class="fu">get_level_names</span>()</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt; [1] &quot;time&quot;</span></span></code></pre></div>
<p>There is a function to configure each level. We can select or
deselect each attribute individually using the attribute name as a
boolean parameter of the function. We can also select or deselect all
attributes defined at the level using the special
<code>include_all</code> and <code>exclude_all</code> parameters: Once
all the attributes have been updated with these special parameters, in
the same function call, we can select or deselect the attributes we
want.</p>
<p>For example, if we do not want to include the name of the month, we
can configure it using the <code>select_month_level()</code> function or
at the time of object creation with a parameter of the same name, as
shown below.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>w_date_5 <span class="ot">&lt;-</span> w_date <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  <span class="fu">select_month_level</span>(<span class="at">month_name =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>w_date_6 <span class="ot">&lt;-</span> <span class="fu">when</span>(</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>  <span class="at">start =</span> lubridate<span class="sc">::</span><span class="fu">today</span>(),</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>  <span class="at">end =</span> lubridate<span class="sc">::</span><span class="fu">today</span>() <span class="sc">+</span> lubridate<span class="sc">::</span><span class="fu">years</span>(<span class="dv">5</span>),</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>  <span class="at">month_name =</span> <span class="cn">FALSE</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>)</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="fu">identical</span>(w_date_5, w_date_6)</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>w_date_5 <span class="sc">|&gt;</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>  <span class="fu">get_level_attribute_names</span>(<span class="at">name =</span> <span class="st">&#39;month&#39;</span>, <span class="at">selected =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="co">#&gt; [1] &quot;year_month&quot;     &quot;month&quot;          &quot;month_num_name&quot;</span></span></code></pre></div>
<p>If we only want to include the name of the month, we can do it as
follows.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>w_date_7 <span class="ot">&lt;-</span> w_date <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  <span class="fu">select_month_level</span>(<span class="at">exclude_all =</span> <span class="cn">TRUE</span>, <span class="at">month_name =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>w_date_7 <span class="sc">|&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  <span class="fu">get_level_attribute_names</span>(<span class="at">name =</span> <span class="st">&#39;month&#39;</span>, <span class="at">selected =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">#&gt; [1] &quot;month_name&quot;</span></span></code></pre></div>
<p>There is available a similar function for each level: time, date,
week, month, quarter, semester and year.</p>
<p>In the case of the date-based dimension levels, we can select or
deselect them directly using the <code>select_date_levels()</code>
function. It allows us to treat the levels globally in the same way that
we have been treating the attributes. For example, to exclude the month
level we can do the following.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>w_date_8 <span class="ot">&lt;-</span> w_date <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>  <span class="fu">select_date_levels</span>(<span class="at">month_level =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>w_date_8 <span class="sc">|&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>  <span class="fu">get_level_attribute_names</span>(<span class="at">name =</span> <span class="st">&#39;month&#39;</span>, <span class="at">selected =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#&gt; character(0)</span></span></code></pre></div>
<p>We can also perform that same operation at object creation time, as
shown below.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>w_date_9 <span class="ot">&lt;-</span> <span class="fu">when</span>(</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  <span class="at">start =</span> lubridate<span class="sc">::</span><span class="fu">today</span>(),</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  <span class="at">end =</span> lubridate<span class="sc">::</span><span class="fu">today</span>() <span class="sc">+</span> lubridate<span class="sc">::</span><span class="fu">years</span>(<span class="dv">5</span>),</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>  <span class="at">month_level =</span> <span class="cn">FALSE</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>)</span></code></pre></div>
<p>In the case of a time-based dimension, as we have seen, we only
consider one level called “time”, as shown again below.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>w_time <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  <span class="fu">get_level_names</span>()</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;time&quot;</span></span></code></pre></div>
<p>We can configure the attributes it includes using the
<code>select_time_level()</code> function. The attribute called “hour”
must always be included. If we do not include the “minute” attribute
then “second” will not be included either. Below are some examples of
definition and the result obtained.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>w_time_6 <span class="ot">&lt;-</span> w_time <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="fu">select_time_level</span>(<span class="at">exclude_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>w_time_6 <span class="sc">|&gt;</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>  <span class="fu">get_level_attribute_names</span>(<span class="at">selected =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="co">#&gt; [1] &quot;hour&quot;</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>w_time_7 <span class="ot">&lt;-</span> w_time <span class="sc">|&gt;</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>  <span class="fu">select_time_level</span>(<span class="at">minute =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>w_time_7 <span class="sc">|&gt;</span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>  <span class="fu">get_level_attribute_names</span>(<span class="at">selected =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a><span class="co">#&gt; [1] &quot;time&quot;     &quot;hour&quot;     &quot;day_part&quot;</span></span></code></pre></div>
</div>
<div id="generation-of-the-result" class="section level2">
<h2>Generation of the result</h2>
<p>Once the characteristics of the dimension are defined, we can
generate its table.</p>
<p>Although we have not yet generated the dimension table, the following
function returns the names of the attributes it will contain. They can
be obtained as a string or as a vector of strings.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>w_date <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>  <span class="fu">get_table_attribute_names</span>(<span class="at">as_string =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;id&quot;             &quot;date&quot;           &quot;month_day&quot;      &quot;week_day&quot;      </span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;day_name&quot;       &quot;day_num_name&quot;   &quot;year_week&quot;      &quot;week&quot;          </span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;year_month&quot;     &quot;month&quot;          &quot;month_name&quot;     &quot;month_num_name&quot;</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="co">#&gt; [13] &quot;year&quot;</span></span></code></pre></div>
<p>If it is generated in the form of a string
(<code>as_string = TRUE</code>, default option), the result can be used
to easily change the name of the attributes, when the table is
generated, using the <code>set_table_attribute_names()</code> function,
if deemed necessary, as shown in section <a href="#rename_att">Renaming
the attributes</a>.</p>
<p>When we consider that the dimension is already properly defined, we
can generate its corresponding table using the
<code>generate_table()</code> function. We update the definition of the
object. Any errors found will be notified to us.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>w_date <span class="ot">&lt;-</span> w_date <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  <span class="fu">generate_table</span>()</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>w_time <span class="ot">&lt;-</span> w_time <span class="sc">|&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>  <span class="fu">generate_table</span>()</span></code></pre></div>
<p>Once the table is generated, we can export it. If we want to access
the table and it is not yet generated, it will send us an error
message.</p>
<p>If we make changes to the configuration, it is our responsibility to
generate the table again.</p>
</div>
<div id="getting_dim_table" class="section level2">
<h2>Getting the dimension table</h2>
<p>We can access the dimension table to work with it in R (for example
using the <a href="https://CRAN.R-project.org/package=rolap"><code>rolap</code></a>
package), or export it in the format that is most convenient for us to
work with other tools.</p>
<p>Next we access the generated tables and display them. First of all
for the date.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>t_date <span class="ot">&lt;-</span> w_date <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  <span class="fu">get_table</span>()</span></code></pre></div>
<p>The first and last rows of the obtained result are shown below.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>pander<span class="sc">::</span><span class="fu">pandoc.table</span>(<span class="fu">rbind</span>(<span class="fu">head</span>(t_date, <span class="dv">5</span>), <span class="fu">tail</span>(t_date, <span class="dv">5</span>)),</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>                     <span class="at">split.table =</span> <span class="cn">Inf</span>)</span></code></pre></div>
<table>
<colgroup>
<col width="4%" />
<col width="8%" />
<col width="8%" />
<col width="7%" />
<col width="8%" />
<col width="10%" />
<col width="8%" />
<col width="4%" />
<col width="8%" />
<col width="5%" />
<col width="8%" />
<col width="11%" />
<col width="4%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">id</th>
<th align="center">date</th>
<th align="center">month_day</th>
<th align="center">week_day</th>
<th align="center">day_name</th>
<th align="center">day_num_name</th>
<th align="center">year_week</th>
<th align="center">week</th>
<th align="center">year_month</th>
<th align="center">month</th>
<th align="center">month_name</th>
<th align="center">month_num_name</th>
<th align="center">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">2024-01-08</td>
<td align="center">08</td>
<td align="center">1</td>
<td align="center">lunes</td>
<td align="center">1-lunes</td>
<td align="center">2024-02</td>
<td align="center">02</td>
<td align="center">2024-01</td>
<td align="center">01</td>
<td align="center">enero</td>
<td align="center">01-enero</td>
<td align="center">2024</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">2024-01-09</td>
<td align="center">09</td>
<td align="center">2</td>
<td align="center">martes</td>
<td align="center">2-martes</td>
<td align="center">2024-02</td>
<td align="center">02</td>
<td align="center">2024-01</td>
<td align="center">01</td>
<td align="center">enero</td>
<td align="center">01-enero</td>
<td align="center">2024</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">2024-01-10</td>
<td align="center">10</td>
<td align="center">3</td>
<td align="center">miércoles</td>
<td align="center">3-miércoles</td>
<td align="center">2024-02</td>
<td align="center">02</td>
<td align="center">2024-01</td>
<td align="center">01</td>
<td align="center">enero</td>
<td align="center">01-enero</td>
<td align="center">2024</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">2024-01-11</td>
<td align="center">11</td>
<td align="center">4</td>
<td align="center">jueves</td>
<td align="center">4-jueves</td>
<td align="center">2024-02</td>
<td align="center">02</td>
<td align="center">2024-01</td>
<td align="center">01</td>
<td align="center">enero</td>
<td align="center">01-enero</td>
<td align="center">2024</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">2024-01-12</td>
<td align="center">12</td>
<td align="center">5</td>
<td align="center">viernes</td>
<td align="center">5-viernes</td>
<td align="center">2024-02</td>
<td align="center">02</td>
<td align="center">2024-01</td>
<td align="center">01</td>
<td align="center">enero</td>
<td align="center">01-enero</td>
<td align="center">2024</td>
</tr>
<tr class="even">
<td align="center">1824</td>
<td align="center">2029-01-04</td>
<td align="center">04</td>
<td align="center">4</td>
<td align="center">jueves</td>
<td align="center">4-jueves</td>
<td align="center">2029-01</td>
<td align="center">01</td>
<td align="center">2029-01</td>
<td align="center">01</td>
<td align="center">enero</td>
<td align="center">01-enero</td>
<td align="center">2029</td>
</tr>
<tr class="odd">
<td align="center">1825</td>
<td align="center">2029-01-05</td>
<td align="center">05</td>
<td align="center">5</td>
<td align="center">viernes</td>
<td align="center">5-viernes</td>
<td align="center">2029-01</td>
<td align="center">01</td>
<td align="center">2029-01</td>
<td align="center">01</td>
<td align="center">enero</td>
<td align="center">01-enero</td>
<td align="center">2029</td>
</tr>
<tr class="even">
<td align="center">1826</td>
<td align="center">2029-01-06</td>
<td align="center">06</td>
<td align="center">6</td>
<td align="center">sábado</td>
<td align="center">6-sábado</td>
<td align="center">2029-01</td>
<td align="center">01</td>
<td align="center">2029-01</td>
<td align="center">01</td>
<td align="center">enero</td>
<td align="center">01-enero</td>
<td align="center">2029</td>
</tr>
<tr class="odd">
<td align="center">1827</td>
<td align="center">2029-01-07</td>
<td align="center">07</td>
<td align="center">7</td>
<td align="center">domingo</td>
<td align="center">7-domingo</td>
<td align="center">2029-01</td>
<td align="center">01</td>
<td align="center">2029-01</td>
<td align="center">01</td>
<td align="center">enero</td>
<td align="center">01-enero</td>
<td align="center">2029</td>
</tr>
<tr class="even">
<td align="center">1828</td>
<td align="center">2029-01-08</td>
<td align="center">08</td>
<td align="center">1</td>
<td align="center">lunes</td>
<td align="center">1-lunes</td>
<td align="center">2029-02</td>
<td align="center">02</td>
<td align="center">2029-01</td>
<td align="center">01</td>
<td align="center">enero</td>
<td align="center">01-enero</td>
<td align="center">2029</td>
</tr>
</tbody>
</table>
<p>Let’s generate the dimension at the week level including all its
attributes (if we change the definition, we have to generate the table
again).</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>t_date <span class="ot">&lt;-</span> w_date <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>  <span class="fu">select_date_levels</span>(<span class="at">day_level =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>  <span class="fu">select_week_level</span>(<span class="at">include_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>  <span class="fu">generate_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>  <span class="fu">get_table</span>()</span></code></pre></div>
<p>The first and last rows of the obtained result are shown below.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>pander<span class="sc">::</span><span class="fu">pandoc.table</span>(<span class="fu">rbind</span>(<span class="fu">head</span>(t_date, <span class="dv">5</span>), <span class="fu">tail</span>(t_date, <span class="dv">5</span>)),</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>                     <span class="at">split.table =</span> <span class="cn">Inf</span>)</span></code></pre></div>
<table>
<colgroup>
<col width="7%" />
<col width="14%" />
<col width="8%" />
<col width="15%" />
<col width="9%" />
<col width="15%" />
<col width="20%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">id</th>
<th align="center">year_week</th>
<th align="center">week</th>
<th align="center">year_month</th>
<th align="center">month</th>
<th align="center">month_name</th>
<th align="center">month_num_name</th>
<th align="center">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">2024-02</td>
<td align="center">02</td>
<td align="center">2024-01</td>
<td align="center">01</td>
<td align="center">enero</td>
<td align="center">01-enero</td>
<td align="center">2024</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">2024-03</td>
<td align="center">03</td>
<td align="center">2024-01</td>
<td align="center">01</td>
<td align="center">enero</td>
<td align="center">01-enero</td>
<td align="center">2024</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">2024-04</td>
<td align="center">04</td>
<td align="center">2024-01</td>
<td align="center">01</td>
<td align="center">enero</td>
<td align="center">01-enero</td>
<td align="center">2024</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">2024-05</td>
<td align="center">05</td>
<td align="center">2024-01</td>
<td align="center">01</td>
<td align="center">enero</td>
<td align="center">01-enero</td>
<td align="center">2024</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">2024-05</td>
<td align="center">05</td>
<td align="center">2024-02</td>
<td align="center">02</td>
<td align="center">febrero</td>
<td align="center">02-febrero</td>
<td align="center">2024</td>
</tr>
<tr class="even">
<td align="center">310</td>
<td align="center">2028-51</td>
<td align="center">51</td>
<td align="center">2028-12</td>
<td align="center">12</td>
<td align="center">diciembre</td>
<td align="center">12-diciembre</td>
<td align="center">2028</td>
</tr>
<tr class="odd">
<td align="center">311</td>
<td align="center">2028-52</td>
<td align="center">52</td>
<td align="center">2028-12</td>
<td align="center">12</td>
<td align="center">diciembre</td>
<td align="center">12-diciembre</td>
<td align="center">2028</td>
</tr>
<tr class="even">
<td align="center">312</td>
<td align="center">2028-53</td>
<td align="center">53</td>
<td align="center">2028-12</td>
<td align="center">12</td>
<td align="center">diciembre</td>
<td align="center">12-diciembre</td>
<td align="center">2028</td>
</tr>
<tr class="odd">
<td align="center">313</td>
<td align="center">2029-01</td>
<td align="center">01</td>
<td align="center">2029-01</td>
<td align="center">01</td>
<td align="center">enero</td>
<td align="center">01-enero</td>
<td align="center">2029</td>
</tr>
<tr class="even">
<td align="center">314</td>
<td align="center">2029-02</td>
<td align="center">02</td>
<td align="center">2029-01</td>
<td align="center">01</td>
<td align="center">enero</td>
<td align="center">01-enero</td>
<td align="center">2029</td>
</tr>
</tbody>
</table>
<p>Next for the time.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>t_time <span class="ot">&lt;-</span> w_time <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>  <span class="fu">get_table</span>()</span></code></pre></div>
<p>The start and end of the result table is shown below.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>pander<span class="sc">::</span><span class="fu">pandoc.table</span>(<span class="fu">rbind</span>(<span class="fu">head</span>(t_time, <span class="dv">5</span>), <span class="fu">tail</span>(t_time, <span class="dv">5</span>)),</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>                     <span class="at">split.table =</span> <span class="cn">Inf</span>)</span></code></pre></div>
<table style="width:76%;">
<colgroup>
<col width="11%" />
<col width="15%" />
<col width="9%" />
<col width="12%" />
<col width="12%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">id</th>
<th align="center">time</th>
<th align="center">hour</th>
<th align="center">minute</th>
<th align="center">second</th>
<th align="center">day_part</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">00:00:00</td>
<td align="center">00</td>
<td align="center">00</td>
<td align="center">00</td>
<td align="center">Night</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">00:00:01</td>
<td align="center">00</td>
<td align="center">00</td>
<td align="center">01</td>
<td align="center">Night</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">00:00:02</td>
<td align="center">00</td>
<td align="center">00</td>
<td align="center">02</td>
<td align="center">Night</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">00:00:03</td>
<td align="center">00</td>
<td align="center">00</td>
<td align="center">03</td>
<td align="center">Night</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">00:00:04</td>
<td align="center">00</td>
<td align="center">00</td>
<td align="center">04</td>
<td align="center">Night</td>
</tr>
<tr class="even">
<td align="center">86396</td>
<td align="center">23:59:55</td>
<td align="center">23</td>
<td align="center">59</td>
<td align="center">55</td>
<td align="center">Night</td>
</tr>
<tr class="odd">
<td align="center">86397</td>
<td align="center">23:59:56</td>
<td align="center">23</td>
<td align="center">59</td>
<td align="center">56</td>
<td align="center">Night</td>
</tr>
<tr class="even">
<td align="center">86398</td>
<td align="center">23:59:57</td>
<td align="center">23</td>
<td align="center">59</td>
<td align="center">57</td>
<td align="center">Night</td>
</tr>
<tr class="odd">
<td align="center">86399</td>
<td align="center">23:59:58</td>
<td align="center">23</td>
<td align="center">59</td>
<td align="center">58</td>
<td align="center">Night</td>
</tr>
<tr class="even">
<td align="center">86400</td>
<td align="center">23:59:59</td>
<td align="center">23</td>
<td align="center">59</td>
<td align="center">59</td>
<td align="center">Night</td>
</tr>
</tbody>
</table>
<p><code>day_part</code> is predefined in English. Literals or
associated hours can be accessed and changed using the
<code>get_day_part()</code> and <code>set_day_part()</code> functions,
as shown in section <a href="#name_parts_day">Names of the parts of the
day</a>.</p>
<p>Now we are going to generate it at the minute level.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>t_time <span class="ot">&lt;-</span> w_time <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>  <span class="fu">select_time_level</span>(<span class="at">second =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>  <span class="fu">generate_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>  <span class="fu">get_table</span>()</span></code></pre></div>
<p>The start and end from the new result table is shown below.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>pander<span class="sc">::</span><span class="fu">pandoc.table</span>(<span class="fu">rbind</span>(<span class="fu">head</span>(t_time, <span class="dv">5</span>), <span class="fu">tail</span>(t_time, <span class="dv">5</span>)),</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>                     <span class="at">split.table =</span> <span class="cn">Inf</span>)</span></code></pre></div>
<table style="width:62%;">
<colgroup>
<col width="9%" />
<col width="15%" />
<col width="9%" />
<col width="12%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">id</th>
<th align="center">time</th>
<th align="center">hour</th>
<th align="center">minute</th>
<th align="center">day_part</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">00:00:00</td>
<td align="center">00</td>
<td align="center">00</td>
<td align="center">Night</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">00:01:00</td>
<td align="center">00</td>
<td align="center">01</td>
<td align="center">Night</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">00:02:00</td>
<td align="center">00</td>
<td align="center">02</td>
<td align="center">Night</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">00:03:00</td>
<td align="center">00</td>
<td align="center">03</td>
<td align="center">Night</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">00:04:00</td>
<td align="center">00</td>
<td align="center">04</td>
<td align="center">Night</td>
</tr>
<tr class="even">
<td align="center">1436</td>
<td align="center">23:55:00</td>
<td align="center">23</td>
<td align="center">55</td>
<td align="center">Night</td>
</tr>
<tr class="odd">
<td align="center">1437</td>
<td align="center">23:56:00</td>
<td align="center">23</td>
<td align="center">56</td>
<td align="center">Night</td>
</tr>
<tr class="even">
<td align="center">1438</td>
<td align="center">23:57:00</td>
<td align="center">23</td>
<td align="center">57</td>
<td align="center">Night</td>
</tr>
<tr class="odd">
<td align="center">1439</td>
<td align="center">23:58:00</td>
<td align="center">23</td>
<td align="center">58</td>
<td align="center">Night</td>
</tr>
<tr class="even">
<td align="center">1440</td>
<td align="center">23:59:00</td>
<td align="center">23</td>
<td align="center">59</td>
<td align="center">Night</td>
</tr>
</tbody>
</table>
<p>We can take the generated tables to any Relational DBMS, as shown
below, we just have to pass a connection to the database as a
parameter.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>my_db <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>())</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>w_date <span class="sc">|&gt;</span></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>  <span class="fu">get_table_rdb</span>(my_db)</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>w_time <span class="sc">|&gt;</span></span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>  <span class="fu">get_table_rdb</span>(my_db)</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a>DBI<span class="sc">::</span><span class="fu">dbListTables</span>(my_db)</span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a><span class="co">#&gt; [1] &quot;date&quot; &quot;time&quot;</span></span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a>DBI<span class="sc">::</span><span class="fu">dbDisconnect</span>(my_db)</span></code></pre></div>
<p>In the previous example, since we have not explicitly defined any
names for the tables in the configuration, they have been assigned as a
name the element on which they are based (date or time). We can define
these names, as shown in section <a href="#table_name">Table
name</a>.</p>
<p>Functions to get the tables in <em>xlsx</em> and <em>csv</em> format
are also available: <code>get_table_xlsx()</code> and
<code>get_table_csv()</code>.</p>
</div>
</div>
<div id="other_config_options" class="section level1">
<h1>Other configuration options</h1>
<p>In section <a href="#general_aspects">Definition of general
aspects</a> we have presented the necessary configuration options for
the examples we have used. In particular, we have only needed to define
the type on which the dimension is based (time or date) and the language
for naming days and months (because it is different from the language of
our operating system). The default options have been adequate for the
examples shown.</p>
<p>In this section we are going to show other configuration options that
may be necessary to define our dimensions.</p>
<div id="dimension-table-features" class="section level2">
<h2>Dimension table features</h2>
<p>The result of a definition operation performed with the
<code>where</code> package is a table of a dimension at a given level of
granularity, with the attributes selected for that level or associated
coarser levels. So far we have focused on level attributes and table
instances. In this section we are going to configure other
characteristics of it.</p>
<div id="table_name" class="section level3">
<h3>Table name</h3>
<p>By default, the table is assigned the name of the base component used
to generate the dimension: date or time. We have seen it in the tables
that we have stored in the database, in the example of the section <a href="#getting_dim_table">Getting the dimension table</a>.</p>
<p>We can define the name of the dimension at the time of object
creation or through the <code>define_characteristics()</code> function,
as shown below.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>wd_1 <span class="ot">&lt;-</span> <span class="fu">when</span>(<span class="at">name =</span> <span class="st">&#39;dim_where&#39;</span>)</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>wd_2 <span class="ot">&lt;-</span> <span class="fu">when</span>() <span class="sc">|&gt;</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>  <span class="fu">define_characteristics</span>(<span class="at">name =</span> <span class="st">&#39;dim_where&#39;</span>)</span></code></pre></div>
<p>This name is the one that will be assigned to the database table
where we store it or to the files we obtain. Below is the case for a
relational database.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>my_db <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>())</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>wd_1 <span class="sc">|&gt;</span></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>  <span class="fu">generate_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>  <span class="fu">get_table_rdb</span>(my_db)</span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>DBI<span class="sc">::</span><span class="fu">dbListTables</span>(my_db)</span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a><span class="co">#&gt; [1] &quot;dim_where&quot;</span></span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a>DBI<span class="sc">::</span><span class="fu">dbDisconnect</span>(my_db)</span></code></pre></div>
<p>Also the case of obtaining it in <em>csv</em> format (if we do not
indicate a location, it stores it in one by default).</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>wd_2 <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>  <span class="fu">generate_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>  <span class="fu">get_table_csv</span>()</span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a><span class="co">#&gt; [1] &quot;C:\\Users\\joses\\AppData\\Local\\Temp\\Rtmp6XNQKs/dim_where.csv&quot;</span></span></code></pre></div>
</div>
<div id="surrogate-key" class="section level3">
<h3>Surrogate key</h3>
<p>By default the dimension table will include a surrogate key. In some
situations we may be interested in the table having the date itself as
its primary key (for example if we want to partition the fact table by
the date).</p>
<p>Through the <code>surrogate_key</code> parameter, included in the
<code>define_characteristics()</code> function and also the
<code>when()</code> function, we can indicate that a surrogate key is
not created, as it’s shown in the following.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="fu">when</span>() <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>  <span class="fu">get_table_attribute_names</span>(<span class="at">as_string =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;id&quot;             &quot;date&quot;           &quot;month_day&quot;      &quot;week_day&quot;      </span></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;day_name&quot;       &quot;day_num_name&quot;   &quot;year_week&quot;      &quot;week&quot;          </span></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;year_month&quot;     &quot;month&quot;          &quot;month_name&quot;     &quot;month_num_name&quot;</span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a><span class="co">#&gt; [13] &quot;year&quot;</span></span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a><span class="fu">when</span>(<span class="at">surrogate_key =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a>  <span class="fu">get_table_attribute_names</span>(<span class="at">as_string =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;date&quot;           &quot;month_day&quot;      &quot;week_day&quot;       &quot;day_name&quot;      </span></span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;day_num_name&quot;   &quot;year_week&quot;      &quot;week&quot;           &quot;year_month&quot;    </span></span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;month&quot;          &quot;month_name&quot;     &quot;month_num_name&quot; &quot;year&quot;</span></span></code></pre></div>
<p>The name of the surrogate key is <code>id</code>, is the first
attribute of the table. If necessary, we can rename the attributes,
including the surrogate key as shown in the next section.</p>
</div>
<div id="rename_att" class="section level3">
<h3>Renaming the attributes</h3>
<p>If we get a table in <code>tibble</code> format, we can rename its
attributes using the functions of this class. But if we want to obtain
it in a file or in a database, we may be interested in renaming its
attributes before obtaining it.</p>
<p>In order to rename the attributes, we first have to generate the
table.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>wd_3 <span class="ot">&lt;-</span> <span class="fu">when</span>() <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>  <span class="fu">generate_table</span>()</span></code></pre></div>
<p>We can rename them using the <code>set_table_attribute_names()</code>
function, passing a name for each of the available attributes. To
facilitate the operation, using the
<code>get_table_attribute_names()</code> function, we can obtain the
attributes in string format. With this we only have to replace the names
that we want to change, as shown below.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a>wd_3 <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>  <span class="fu">get_table_attribute_names</span>()</span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;c(&#39;id&#39;, &#39;date&#39;, &#39;month_day&#39;, &#39;week_day&#39;, &#39;day_name&#39;, &#39;day_num_name&#39;, &#39;year_week&#39;, &#39;week&#39;, &#39;year_month&#39;, &#39;month&#39;, &#39;month_name&#39;, &#39;month_num_name&#39;, &#39;year&#39;)&quot;</span></span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a>wd_3 <span class="ot">&lt;-</span> wd_3 <span class="sc">|&gt;</span></span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a>  <span class="fu">set_table_attribute_names</span>(</span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a>    <span class="fu">c</span>(</span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a>      <span class="st">&#39;id_when&#39;</span>,</span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a>      <span class="st">&#39;date&#39;</span>,</span>
<span id="cb35-10"><a href="#cb35-10" tabindex="-1"></a>      <span class="st">&#39;month_day&#39;</span>,</span>
<span id="cb35-11"><a href="#cb35-11" tabindex="-1"></a>      <span class="st">&#39;week_day&#39;</span>,</span>
<span id="cb35-12"><a href="#cb35-12" tabindex="-1"></a>      <span class="st">&#39;day_name&#39;</span>,</span>
<span id="cb35-13"><a href="#cb35-13" tabindex="-1"></a>      <span class="st">&#39;day_num_name&#39;</span>,</span>
<span id="cb35-14"><a href="#cb35-14" tabindex="-1"></a>      <span class="st">&#39;year_week&#39;</span>,</span>
<span id="cb35-15"><a href="#cb35-15" tabindex="-1"></a>      <span class="st">&#39;week&#39;</span>,</span>
<span id="cb35-16"><a href="#cb35-16" tabindex="-1"></a>      <span class="st">&#39;year_month&#39;</span>,</span>
<span id="cb35-17"><a href="#cb35-17" tabindex="-1"></a>      <span class="st">&#39;month&#39;</span>,</span>
<span id="cb35-18"><a href="#cb35-18" tabindex="-1"></a>      <span class="st">&#39;month_name&#39;</span>,</span>
<span id="cb35-19"><a href="#cb35-19" tabindex="-1"></a>      <span class="st">&#39;month_num_name&#39;</span>,</span>
<span id="cb35-20"><a href="#cb35-20" tabindex="-1"></a>      <span class="st">&#39;year&#39;</span></span>
<span id="cb35-21"><a href="#cb35-21" tabindex="-1"></a>    )</span>
<span id="cb35-22"><a href="#cb35-22" tabindex="-1"></a>  )</span>
<span id="cb35-23"><a href="#cb35-23" tabindex="-1"></a></span>
<span id="cb35-24"><a href="#cb35-24" tabindex="-1"></a>wd_3 <span class="sc">|&gt;</span></span>
<span id="cb35-25"><a href="#cb35-25" tabindex="-1"></a>  <span class="fu">get_table_attribute_names</span>(<span class="at">as_string =</span> <span class="cn">FALSE</span>)</span>
<span id="cb35-26"><a href="#cb35-26" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;id_when&quot;        &quot;date&quot;           &quot;month_day&quot;      &quot;week_day&quot;      </span></span>
<span id="cb35-27"><a href="#cb35-27" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;day_name&quot;       &quot;day_num_name&quot;   &quot;year_week&quot;      &quot;week&quot;          </span></span>
<span id="cb35-28"><a href="#cb35-28" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;year_month&quot;     &quot;month&quot;          &quot;month_name&quot;     &quot;month_num_name&quot;</span></span>
<span id="cb35-29"><a href="#cb35-29" tabindex="-1"></a><span class="co">#&gt; [13] &quot;year&quot;</span></span></code></pre></div>
</div>
</div>
<div id="name_parts_day" class="section level2">
<h2>Names of the parts of the day</h2>
<p>We have associated each hour with the usual part of the day in
English. We can consult them and change them if necessary (for example,
to define them in another language) using the
<code>get_day_part()</code> and <code>set_day_part()</code>
functions.</p>
<p>Below is an example where the definition is modified to consider only
two parts in the day.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="fu">when</span>() <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>  <span class="fu">get_day_part</span>()</span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a><span class="co">#&gt;          00          01          02          03          04          05 </span></span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a><span class="co">#&gt;     &quot;Night&quot;     &quot;Night&quot;     &quot;Night&quot;     &quot;Night&quot;     &quot;Night&quot;   &quot;Morning&quot; </span></span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a><span class="co">#&gt;          06          07          08          09          10          11 </span></span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a><span class="co">#&gt;   &quot;Morning&quot;   &quot;Morning&quot;   &quot;Morning&quot;   &quot;Morning&quot;   &quot;Morning&quot;   &quot;Morning&quot; </span></span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a><span class="co">#&gt;          12          13          14          15          16          17 </span></span>
<span id="cb36-8"><a href="#cb36-8" tabindex="-1"></a><span class="co">#&gt; &quot;Afternoon&quot; &quot;Afternoon&quot; &quot;Afternoon&quot; &quot;Afternoon&quot; &quot;Afternoon&quot;   &quot;Evening&quot; </span></span>
<span id="cb36-9"><a href="#cb36-9" tabindex="-1"></a><span class="co">#&gt;          18          19          20          21          22          23 </span></span>
<span id="cb36-10"><a href="#cb36-10" tabindex="-1"></a><span class="co">#&gt;   &quot;Evening&quot;   &quot;Evening&quot;   &quot;Evening&quot;     &quot;Night&quot;     &quot;Night&quot;     &quot;Night&quot;</span></span>
<span id="cb36-11"><a href="#cb36-11" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" tabindex="-1"></a><span class="fu">when</span>() <span class="sc">|&gt;</span></span>
<span id="cb36-13"><a href="#cb36-13" tabindex="-1"></a>  <span class="fu">set_day_part</span>(<span class="at">hour =</span> <span class="fu">c</span>(<span class="dv">20</span><span class="sc">:</span><span class="dv">23</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>), <span class="at">name =</span> <span class="st">&quot;Night&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-14"><a href="#cb36-14" tabindex="-1"></a>  <span class="fu">set_day_part</span>(<span class="at">hour =</span> <span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">19</span>), <span class="at">name =</span> <span class="st">&quot;Day&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-15"><a href="#cb36-15" tabindex="-1"></a>  <span class="fu">get_day_part</span>()</span>
<span id="cb36-16"><a href="#cb36-16" tabindex="-1"></a><span class="co">#&gt;      00      01      02      03      04      05      06      07      08      09 </span></span>
<span id="cb36-17"><a href="#cb36-17" tabindex="-1"></a><span class="co">#&gt; &quot;Night&quot; &quot;Night&quot; &quot;Night&quot; &quot;Night&quot; &quot;Night&quot; &quot;Night&quot;   &quot;Day&quot;   &quot;Day&quot;   &quot;Day&quot;   &quot;Day&quot; </span></span>
<span id="cb36-18"><a href="#cb36-18" tabindex="-1"></a><span class="co">#&gt;      10      11      12      13      14      15      16      17      18      19 </span></span>
<span id="cb36-19"><a href="#cb36-19" tabindex="-1"></a><span class="co">#&gt;   &quot;Day&quot;   &quot;Day&quot;   &quot;Day&quot;   &quot;Day&quot;   &quot;Day&quot;   &quot;Day&quot;   &quot;Day&quot;   &quot;Day&quot;   &quot;Day&quot;   &quot;Day&quot; </span></span>
<span id="cb36-20"><a href="#cb36-20" tabindex="-1"></a><span class="co">#&gt;      20      21      22      23 </span></span>
<span id="cb36-21"><a href="#cb36-21" tabindex="-1"></a><span class="co">#&gt; &quot;Night&quot; &quot;Night&quot; &quot;Night&quot; &quot;Night&quot;</span></span></code></pre></div>
</div>
<div id="configuration-of-day-and-week-levels" class="section level2">
<h2>Configuration of day and week levels</h2>
<p>This section shows the configuration options available for the day
and week levels.</p>
<div id="the-first-day-of-the-week" class="section level3">
<h3>The first day of the week</h3>
<p>For days, in addition to the language of the name of the day of the
week, we can define the start day of the week. There are two
possibilities: Monday or Sunday. This determines the numbering of the
days.</p>
<p>We can define it using the parameter <code>week_starts_monday</code>
(which by default has the value TRUE) in the functions
<code>define_characteristics()</code> or <code>when()</code>, as shown
below.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>wd_1 <span class="ot">&lt;-</span> <span class="fu">when</span>(<span class="at">week_starts_monday =</span> <span class="cn">FALSE</span>)</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a>wd_2 <span class="ot">&lt;-</span> <span class="fu">when</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>  <span class="fu">define_characteristics</span>(<span class="at">week_starts_monday =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<div id="numbering-of-weeks-in-the-year" class="section level3">
<h3>Numbering of weeks in the year</h3>
<p>Using the value of the <code>type</code> parameter
(<code>type = &quot;date&quot;</code> or <code>type = &quot;time&quot;</code>) in the
<code>define_characteristics()</code> or <code>when()</code> functions
we can indicate whether the dimension is based on date or time.</p>
<p>This parameter can additionally take two more values: “iso” and
“epi”. Using these values (together with the “date” value) we can
indicate the type of numbering of the weeks in the year. That is, the
week number associated with each date depends on the type of date
dimension selected:</p>
<ul>
<li><p>Default (<code>type = &quot;date&quot;</code>): It numbers blocks of 7 days
beginning on January 1 (regardless of what day of the week it is). The
last week of the year will last less than 7 days.</p></li>
<li><p>ISO 8601 (<code>type = &quot;iso&quot;</code>): It numbers blocks of 7 days
from Monday to Sunday. The first and last week of the year can contain
days from the previous or next year.</p></li>
<li><p>Epidemiological (<code>type = &quot;epi&quot;</code>): This week is like
ISO 8601 only that it considers that the week begins on Sunday.</p></li>
</ul>
<p>For the first and last days of the year, the year associated with the
week may be different from the year of the date, depending on the type
selected (“iso” or “epi”).</p>
<p>The “year” attribute (alone or in combination with other attributes)
displays the year associated with the date, regardless of the type
selected. Only the “year_week” attribute displays the year of the week
according to the selected type.</p>
<p>The next section shows how to obtain the attribute obtaining function
and how to change it if we consider it necessary (for example, to get
the different year types together).</p>
</div>
<div id="get-date-range-of-weeks" class="section level3">
<h3>Get date range of weeks</h3>
<p>If we want to work with the dimension at the week level, we may be
interested in having the start or end date for each week. To obtain them
and be able to use them to generate the dimension, we have the
<code>get_week_date_range()</code> function.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">get_week_date_range</span>(<span class="at">start =</span> <span class="st">&quot;2024-01-01&quot;</span>, <span class="at">end =</span> <span class="st">&quot;2029-12-31&quot;</span>)</span></code></pre></div>
<p>A period and the type of week numbering (“date”, “iso” or “epi”) are
indicated (by default it is “date”). Returns the result in
<code>tibble</code> form.</p>
<p>The start and end from the new result is shown below.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a>pander<span class="sc">::</span><span class="fu">pandoc.table</span>(<span class="fu">rbind</span>(<span class="fu">head</span>(t, <span class="dv">5</span>), <span class="fu">tail</span>(t, <span class="dv">5</span>)),</span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a>                     <span class="at">split.table =</span> <span class="cn">Inf</span>)</span></code></pre></div>
<table style="width:53%;">
<colgroup>
<col width="16%" />
<col width="18%" />
<col width="18%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">year_week</th>
<th align="center">first</th>
<th align="center">last</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">2024-01</td>
<td align="center">2024-01-01</td>
<td align="center">2024-01-07</td>
</tr>
<tr class="even">
<td align="center">2024-02</td>
<td align="center">2024-01-08</td>
<td align="center">2024-01-14</td>
</tr>
<tr class="odd">
<td align="center">2024-03</td>
<td align="center">2024-01-15</td>
<td align="center">2024-01-21</td>
</tr>
<tr class="even">
<td align="center">2024-04</td>
<td align="center">2024-01-22</td>
<td align="center">2024-01-28</td>
</tr>
<tr class="odd">
<td align="center">2024-05</td>
<td align="center">2024-01-29</td>
<td align="center">2024-02-04</td>
</tr>
<tr class="even">
<td align="center">2029-49</td>
<td align="center">2029-12-03</td>
<td align="center">2029-12-09</td>
</tr>
<tr class="odd">
<td align="center">2029-50</td>
<td align="center">2029-12-10</td>
<td align="center">2029-12-16</td>
</tr>
<tr class="even">
<td align="center">2029-51</td>
<td align="center">2029-12-17</td>
<td align="center">2029-12-23</td>
</tr>
<tr class="odd">
<td align="center">2029-52</td>
<td align="center">2029-12-24</td>
<td align="center">2029-12-30</td>
</tr>
<tr class="even">
<td align="center">2029-53</td>
<td align="center">2029-12-31</td>
<td align="center">2029-12-31</td>
</tr>
</tbody>
</table>
<p>We can use the column of the dates that interest us to generate the
dimension. Additionally, we leave only the date and the levels that
interest us (week and year).</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a>tw <span class="ot">&lt;-</span> <span class="fu">when</span>(<span class="at">values =</span> t[[<span class="st">&quot;last&quot;</span>]], <span class="at">month_level =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>  <span class="fu">select_day_level</span>(<span class="at">exclude_all =</span> <span class="cn">TRUE</span>, <span class="at">date =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a>  <span class="fu">generate_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a>  <span class="fu">get_table</span>()</span></code></pre></div>
<p>The start and end from the new result table is shown below.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a>pander<span class="sc">::</span><span class="fu">pandoc.table</span>(<span class="fu">rbind</span>(<span class="fu">head</span>(tw, <span class="dv">5</span>), <span class="fu">tail</span>(tw, <span class="dv">5</span>)),</span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>                     <span class="at">split.table =</span> <span class="cn">Inf</span>)</span></code></pre></div>
<table style="width:62%;">
<colgroup>
<col width="8%" />
<col width="18%" />
<col width="16%" />
<col width="9%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">id</th>
<th align="center">date</th>
<th align="center">year_week</th>
<th align="center">week</th>
<th align="center">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">2024-01-07</td>
<td align="center">2024-01</td>
<td align="center">01</td>
<td align="center">2024</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">2024-01-14</td>
<td align="center">2024-02</td>
<td align="center">02</td>
<td align="center">2024</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">2024-01-21</td>
<td align="center">2024-03</td>
<td align="center">03</td>
<td align="center">2024</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">2024-01-28</td>
<td align="center">2024-04</td>
<td align="center">04</td>
<td align="center">2024</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">2024-02-04</td>
<td align="center">2024-05</td>
<td align="center">05</td>
<td align="center">2024</td>
</tr>
<tr class="even">
<td align="center">314</td>
<td align="center">2029-12-09</td>
<td align="center">2029-49</td>
<td align="center">49</td>
<td align="center">2029</td>
</tr>
<tr class="odd">
<td align="center">315</td>
<td align="center">2029-12-16</td>
<td align="center">2029-50</td>
<td align="center">50</td>
<td align="center">2029</td>
</tr>
<tr class="even">
<td align="center">316</td>
<td align="center">2029-12-23</td>
<td align="center">2029-51</td>
<td align="center">51</td>
<td align="center">2029</td>
</tr>
<tr class="odd">
<td align="center">317</td>
<td align="center">2029-12-30</td>
<td align="center">2029-52</td>
<td align="center">52</td>
<td align="center">2029</td>
</tr>
<tr class="even">
<td align="center">318</td>
<td align="center">2029-12-31</td>
<td align="center">2029-53</td>
<td align="center">53</td>
<td align="center">2029</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="change_def_function_att" class="section level2">
<h2>Change the definition function of an attribute</h2>
<p>Each attribute is defined by a specific function. All definition
functions have the same structure: they receive a <em>table</em>, a
column with the date or time <em>values</em>, possibly additional
configuration parameters, and return the <em>table</em> to which a new
column with the attribute name and values has been added, calculated
from the values.</p>
<p>We can get the definition function of any attribute using the
<code>get_attribute_definition_function()</code> function. Below is the
function for the “year” attribute and also the function of the year and
week combination, “year_week” attribute (it uses one of the additional
parameters available, the dimension type).</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a>wd <span class="ot">&lt;-</span> <span class="fu">when</span>()</span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a>wd <span class="sc">|&gt;</span></span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a>  <span class="fu">get_attribute_definition_function</span>(<span class="at">name =</span> <span class="st">&quot;year&quot;</span>)</span>
<span id="cb42-5"><a href="#cb42-5" tabindex="-1"></a><span class="co">#&gt; function (table, values, ...) </span></span>
<span id="cb42-6"><a href="#cb42-6" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb42-7"><a href="#cb42-7" tabindex="-1"></a><span class="co">#&gt;     table[[&quot;year&quot;]] &lt;- as.character(lubridate::year(values))</span></span>
<span id="cb42-8"><a href="#cb42-8" tabindex="-1"></a><span class="co">#&gt;     table</span></span>
<span id="cb42-9"><a href="#cb42-9" tabindex="-1"></a><span class="co">#&gt; }</span></span>
<span id="cb42-10"><a href="#cb42-10" tabindex="-1"></a><span class="co">#&gt; &lt;bytecode: 0x000001cf0e5cdc48&gt;</span></span>
<span id="cb42-11"><a href="#cb42-11" tabindex="-1"></a><span class="co">#&gt; &lt;environment: namespace:when&gt;</span></span>
<span id="cb42-12"><a href="#cb42-12" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" tabindex="-1"></a>wd <span class="sc">|&gt;</span></span>
<span id="cb42-14"><a href="#cb42-14" tabindex="-1"></a>  <span class="fu">get_attribute_definition_function</span>(<span class="at">name =</span> <span class="st">&quot;year_week&quot;</span>)</span>
<span id="cb42-15"><a href="#cb42-15" tabindex="-1"></a><span class="co">#&gt; function (table, values, ...) </span></span>
<span id="cb42-16"><a href="#cb42-16" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb42-17"><a href="#cb42-17" tabindex="-1"></a><span class="co">#&gt;     dots &lt;- list(...)</span></span>
<span id="cb42-18"><a href="#cb42-18" tabindex="-1"></a><span class="co">#&gt;     type &lt;- dots[[&quot;type&quot;]]</span></span>
<span id="cb42-19"><a href="#cb42-19" tabindex="-1"></a><span class="co">#&gt;     switch(type, iso = {</span></span>
<span id="cb42-20"><a href="#cb42-20" tabindex="-1"></a><span class="co">#&gt;         year &lt;- lubridate::isoyear(values)</span></span>
<span id="cb42-21"><a href="#cb42-21" tabindex="-1"></a><span class="co">#&gt;         week &lt;- lubridate::isoweek(values)</span></span>
<span id="cb42-22"><a href="#cb42-22" tabindex="-1"></a><span class="co">#&gt;     }, epi = {</span></span>
<span id="cb42-23"><a href="#cb42-23" tabindex="-1"></a><span class="co">#&gt;         year &lt;- lubridate::epiyear(values)</span></span>
<span id="cb42-24"><a href="#cb42-24" tabindex="-1"></a><span class="co">#&gt;         week &lt;- lubridate::epiweek(values)</span></span>
<span id="cb42-25"><a href="#cb42-25" tabindex="-1"></a><span class="co">#&gt;     }, {</span></span>
<span id="cb42-26"><a href="#cb42-26" tabindex="-1"></a><span class="co">#&gt;         year &lt;- lubridate::year(values)</span></span>
<span id="cb42-27"><a href="#cb42-27" tabindex="-1"></a><span class="co">#&gt;         week &lt;- lubridate::week(values)</span></span>
<span id="cb42-28"><a href="#cb42-28" tabindex="-1"></a><span class="co">#&gt;     })</span></span>
<span id="cb42-29"><a href="#cb42-29" tabindex="-1"></a><span class="co">#&gt;     table[[&quot;year_week&quot;]] &lt;- paste0(year, &quot;-&quot;, sprintf(&quot;%02d&quot;, </span></span>
<span id="cb42-30"><a href="#cb42-30" tabindex="-1"></a><span class="co">#&gt;         week))</span></span>
<span id="cb42-31"><a href="#cb42-31" tabindex="-1"></a><span class="co">#&gt;     table</span></span>
<span id="cb42-32"><a href="#cb42-32" tabindex="-1"></a><span class="co">#&gt; }</span></span>
<span id="cb42-33"><a href="#cb42-33" tabindex="-1"></a><span class="co">#&gt; &lt;bytecode: 0x000001cf0e628150&gt;</span></span>
<span id="cb42-34"><a href="#cb42-34" tabindex="-1"></a><span class="co">#&gt; &lt;environment: namespace:when&gt;</span></span></code></pre></div>
<p>In view of the functions, we can define one with the same structure
and establish it as a new attribute definition function using the
<code>set_attribute_definition_function()</code> function. For example,
below shows how to change the year attribute definition function to get
an additional attribute if the year associated with the week can be
different from the year of the date.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(table, values, ...) {</span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>  dots <span class="ot">&lt;-</span> <span class="fu">list</span>(...)</span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a>  type <span class="ot">&lt;-</span> dots[[<span class="st">&#39;type&#39;</span>]]</span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a>  table[[<span class="st">&#39;year&#39;</span>]] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(values))</span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a>  <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">&#39;iso&#39;</span>) {</span>
<span id="cb43-6"><a href="#cb43-6" tabindex="-1"></a>    table[[<span class="st">&#39;week_year&#39;</span>]] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(lubridate<span class="sc">::</span><span class="fu">isoyear</span>(values))</span>
<span id="cb43-7"><a href="#cb43-7" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">&#39;epi&#39;</span>) {</span>
<span id="cb43-8"><a href="#cb43-8" tabindex="-1"></a>    table[[<span class="st">&#39;week_year&#39;</span>]] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(lubridate<span class="sc">::</span><span class="fu">epiyear</span>(values))</span>
<span id="cb43-9"><a href="#cb43-9" tabindex="-1"></a>  }</span>
<span id="cb43-10"><a href="#cb43-10" tabindex="-1"></a>  table</span>
<span id="cb43-11"><a href="#cb43-11" tabindex="-1"></a>}</span>
<span id="cb43-12"><a href="#cb43-12" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" tabindex="-1"></a>wd <span class="ot">&lt;-</span> wd <span class="sc">|&gt;</span></span>
<span id="cb43-14"><a href="#cb43-14" tabindex="-1"></a>  <span class="fu">set_attribute_definition_function</span>(<span class="at">name =</span> <span class="st">&quot;year&quot;</span>, f)</span></code></pre></div>
<p>In this case, what we do is add two columns for the year: one with
the year of the date and another with the year of the week if this can
be different from the first. We can see the result by changing the type
of the dimension and generating the table, as shown below (the two year
attributes have been added).</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a>t <span class="ot">&lt;-</span> wd <span class="sc">|&gt;</span></span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a>  <span class="fu">define_characteristics</span>(<span class="at">type =</span> <span class="st">&#39;iso&#39;</span>) <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a>  <span class="fu">generate_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb44-4"><a href="#cb44-4" tabindex="-1"></a>  <span class="fu">get_table</span>()</span>
<span id="cb44-5"><a href="#cb44-5" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" tabindex="-1"></a><span class="fu">names</span>(t)</span>
<span id="cb44-7"><a href="#cb44-7" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;id&quot;             &quot;date&quot;           &quot;month_day&quot;      &quot;week_day&quot;      </span></span>
<span id="cb44-8"><a href="#cb44-8" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;day_name&quot;       &quot;day_num_name&quot;   &quot;year_week&quot;      &quot;week&quot;          </span></span>
<span id="cb44-9"><a href="#cb44-9" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;year_month&quot;     &quot;month&quot;          &quot;month_name&quot;     &quot;month_num_name&quot;</span></span>
<span id="cb44-10"><a href="#cb44-10" tabindex="-1"></a><span class="co">#&gt; [13] &quot;year&quot;           &quot;week_year&quot;</span></span></code></pre></div>
</div>
</div>
<div id="conclusions" class="section level1">
<h1>Conclusions</h1>
<p>The <code>when</code> package offers a set of operations that allow
us to generate the <em>When Dimension</em> based on date or time at the
level of detail we need.</p>
<p>We create an object of the <code>when</code> class and, from it, we
configure the instances and characteristics of the levels and attributes
of the dimension. To define the instances we can indicate a range of
values or provide the specific values from which to generate the rest of
the attributes.</p>
<p>As a result, we can obtain tables for this dimension to work from R,
for example with the <a href="https://CRAN.R-project.org/package=rolap"><code>rolap</code></a>
package, or work in other environments, including Relational DBMSs.</p>
</div>
<div id="bibliography" class="section level1 unnumbered">
<h1 class="unnumbered">Bibliography</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-adamson2010star" class="csl-entry">
Adamson, Christopher. 2010. <em>Star Schema: The Complete
Reference</em>. McGraw Hill Professional.
</div>
<div id="ref-kimball1996data" class="csl-entry">
Kimball, Ralph. 1996. <em>The Data Warehouse Toolkit: Practical
Techniques for Building Dimensional Data Warehouses</em>. John Wiley
&amp; Sons.
</div>
<div id="ref-kimball2013data" class="csl-entry">
Kimball, Ralph, and Margy Ross. 2013. <em>The Data Warehouse Toolkit:
The Definitive Guide to Dimensional Modeling</em>. John Wiley &amp;
Sons.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
